# 功能设计文档

> Novel Reader 核心功能设计

**最后更新**: 2025-12-02

---

## 页面结构

### 1. 书架页（首页）

```
┌─────────────────────────────────────────────────────────┐
│  Novel Reader                    [视图切换] [上传]      │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌─────┐  ┌─────┐  ┌─────┐  ┌─────┐                   │
│  │     │  │     │  │     │  │     │                   │
│  │书籍1│  │书籍2│  │书籍3│  │书籍4│    卡片视图       │
│  │     │  │     │  │     │  │     │                   │
│  └─────┘  └─────┘  └─────┘  └─────┘                   │
│   进度50%   进度30%   未读     进度100%                 │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**功能**:
- 书籍卡片展示（封面占位 + 书名 + 进度）
- 卡片/列表视图切换
- 拖拽/点击上传文件
- 右键菜单：删除、重新导入

### 2. 阅读页

```
┌─────────────────────────────────────────────────────────┐
│  ← 返回    [书名]           [搜索] [目录] [设置]        │
├──────────┬──────────────────────────────────────────────┤
│          │                                              │
│  目录    │                                              │
│  ----    │                                              │
│  第1章   │           正文内容区域                        │
│  第2章 ◀ │                                              │
│  第3章   │           支持虚拟滚动                        │
│  ...     │                                              │
│          │                                              │
│          │                                              │
├──────────┴──────────────────────────────────────────────┤
│  ■■■■■■■■■□□□□□□□□□□□   35%   上一章 | 下一章          │
└─────────────────────────────────────────────────────────┘
```

**功能**:
- 可折叠的章节目录
- 虚拟滚动的正文区域
- 底部进度条
- 章节导航

### 3. 设置面板（侧边抽屉）

```
┌─────────────────────┐
│  阅读设置      [×]  │
├─────────────────────┤
│                     │
│  字体               │
│  [思源黑体    ▼]    │
│                     │
│  字号               │
│  ──●────── 16px     │
│                     │
│  行高               │
│  ────●──── 1.8      │
│                     │
│  主题               │
│  [○] 白天           │
│  [●] 夜间           │
│  [○] 护眼           │
│                     │
└─────────────────────┘
```

### 4. 搜索页/弹窗

```
┌─────────────────────────────────────────────────────────┐
│  全局搜索                                        [×]    │
├─────────────────────────────────────────────────────────┤
│  [搜索关键词...                          ] [正则] [搜索]│
├─────────────────────────────────────────────────────────┤
│  找到 156 处匹配，分布在 42 章                          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ▼ 第 12 章 - 初次相遇（8 处）                         │
│     ...他看到【关键词】站在门口...                       │
│     ...【关键词】转过身来...                            │
│                                                         │
│  ▶ 第 23 章 - 再次重逢（5 处）                         │
│                                                         │
│  ▶ 第 45 章 - 最终决战（12 处）                        │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

**功能**:
- 搜索输入（支持正则）
- 结果按章节折叠
- 显示匹配上下文
- 点击跳转到具体位置

---

## 主题配色

### 白天模式
```css
--bg-primary: #ffffff
--bg-secondary: #f8f9fa
--text-primary: #1a1a1a
--text-secondary: #666666
```

### 夜间模式
```css
--bg-primary: #1a1a1a
--bg-secondary: #2d2d2d
--text-primary: #e5e5e5
--text-secondary: #999999
```

### 护眼模式
```css
--bg-primary: #f5f0e6  /* 米黄 */
--bg-secondary: #e8e3d9
--text-primary: #3d3d3d
--text-secondary: #666666
```

---

## 动画设计

### 页面切换
- 使用 Framer Motion
- 淡入淡出 + 轻微位移
- 时长：200-300ms

### 交互反馈
- 按钮点击：scale 0.95
- 悬停：背景色变化
- 开关切换：弹性动画

### 加载状态
- 骨架屏
- 进度指示器
- 搜索中动画

---

## 数据结构

### 书籍存储（IndexedDB）

```javascript
// books 表
{
  id: string,
  title: string,
  content: string,
  chapters: Chapter[],
  metadata: {
    encoding: string,
    fileSize: number,
    totalChapters: number,
    addedAt: timestamp,
  }
}

// progress 表
{
  bookId: string,
  position: number,      // 字符位置
  chapterIndex: number,
  percentage: number,
  updatedAt: timestamp,
}

// bookmarks 表
{
  id: string,
  bookId: string,
  position: number,
  note: string,
  createdAt: timestamp,
}
```

---

## 交互细节

### 文件上传
1. 拖拽区域高亮
2. 解析进度显示
3. 解析完成提示
4. 错误处理（格式不支持、文件过大）

### 阅读体验
1. 滚动位置自动保存（防抖 1s）
2. 章节切换动画
3. 快捷键支持（← → 翻章）

### 搜索体验
1. 输入防抖（300ms）
2. 搜索中显示进度
3. 支持取消搜索
4. 点击结果平滑跳转
